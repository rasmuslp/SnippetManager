{"version":3,"sources":["app/analytics.js","app/app.js","app/auth/auth-controller.js","app/auth/auth-directives.js","app/auth/auth-service.js","app/auth/auth.js","app/home/home.js","app/common/common.js","app/common/config.js","app/common/filters.js","app/common/firebase-factory.js","app/menu/menu-controller.js","app/menu/menu-directive.js","app/menu/menu.js","app/welcome/welcome.js","app/user/user-service.js","app/user/user.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACxBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACtBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AClHA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACvEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACxHA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC3GA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACpJA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACVA;AACA;AACA;AACA;AACA;AACA;AACA;ACNA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AChCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC7HA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACxBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACdA;AACA;AACA;AACA;AACA;AACA;ACLA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACrCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACtGA;AACA;AACA;AACA;AACA;AACA","file":"app.js","sourcesContent":["(function () {\n\t/* jshint -W030, -W033, -W069 */\n\t/* globals ga */\n\n\t'use strict';\n\n\tangular.module('analytics', ['angulartics', 'angulartics.google.analytics'])\n\t.directive('analytics', ['$location', function ($location) {\n\t\treturn {\n\t\t\trestrict: 'A',\n\t\t\tlink: function() {\n\t\t\t\tvar port = $location.port();\n\t\t\t\tif (port === 80 || port === 443) {\n\t\t\t\t\t(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){\n\t\t\t\t\t\t(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),\n\t\t\t\t\t\tm=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)\n\t\t\t\t\t})(window,document,'script','//www.google-analytics.com/analytics.js','ga');\n\n\t\t\t\t\tga('create', 'UA-59950591-1', 'auto');\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t}]);\n\n}());","'use strict';\n\n(function () {\n\n\tangular.module('smApp', ['ngAnimate', 'templates', 'ui.router', 'analytics', 'auth', 'welcome', 'home', 'ngClipboard', 'ngMarkdown'])\n\n\t.config(['ngClipProvider', function(ngClipProvider) {\n\t\tngClipProvider.setPath('assets/ZeroClipboard.swf');\n\t}])\n\n\t.run(['$rootScope', function($rootScope) {\n\t\t$rootScope.$on('$stateChangeError', function(event, toState, toParams, fromState, fromParams, error) {\n\t\t\tconsole.log('State change error: %o', error);\n\t\t});\n\t}]);\n\n\t$(document).on('click','.navbar-collapse.in',function(e) {\n\t\tif($(e.target).is('a') && ($(e.target).attr('class') !== 'dropdown-toggle')) {\n\t\t\t$(this).collapse('hide');\n\t\t}\n\t});\n\n}());","(function () {\n\t'use strict';\n\n\tangular.module('auth.controller', ['auth.service'])\n\n\t.controller('AuthController', ['$state', 'AuthService', 'signup', 'auth', function($state, AuthService, signup, auth) {\n\t\tif (auth !== null) {\n\t\t\t$state.go('auth.redirect');\n\t\t}\n\n\t\tthis.signup = signup;\n\n\t\tthis.user = {\n\t\t\temail: '',\n\t\t\tpassword: '',\n\t\t\tpasswordConfirm: '',\n\t\t\tremember: false\n\t\t};\n\n\t\tthis.working = false;\n\t\tthis.error = {};\n\n\t\tvar self = this;\n\n\t\tvar createAccount = function(email, password) {\n\t\t\treturn AuthService.create(email, password);\n\t\t};\n\n\t\tvar login = function(email, password, remember) {\n\t\t\treturn AuthService.login(email, password, remember);\n\t\t};\n\n\t\tvar errorHandler = function(error) {\n\t\t\tif (error) {\n\t\t\t\t//TODO: Some of thee might contain details that should be logged ?\n\t\t\t\tvar errorsToView = [\n\t\t\t\t\t// Email\n\t\t\t\t\t'EMAIL_TAKEN',\n\t\t\t\t\t'INVALID_EMAIL',\n\t\t\t\t\t'INVALID_USER',\n\n\t\t\t\t\t// Password\n\t\t\t\t\t'INVALID_PASSWORD',\n\n\t\t\t\t\t// Common\n\t\t\t\t\t'NETWORK_ERROR',\n\n\t\t\t\t\t// Provider\n\t\t\t\t\t'PROVIDER_ERROR',\n\t\t\t\t\t'USER_CANCELLED',\n\t\t\t\t\t'USER_DENIED'\n\t\t\t\t];\n\n\t\t\t\tif (errorsToView.indexOf(error.code) === -1) {\n\t\t\t\t\t//TODO: Log\n\t\t\t\t\tconsole.error('AuthController [submit]: Error');\n\t\t\t\t\tconsole.error('Code: ' + error.code);\n\t\t\t\t\tconsole.error('Message: ' + error.message);\n\n\t\t\t\t\tself.error.code = 'GENERAL_ERROR';\n\t\t\t\t} else {\n\t\t\t\t\tself.error.code = error.code;\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tthis.submit = function(valid) {\n\t\t\tif (!valid) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.working = true;\n\t\t\tthis.error = {};\n\n\t\t\tif (this.signup) {\n\t\t\t\tconsole.log('AuthController [submit]: Sign up!');\n\n\t\t\t\tvar user = this.user;\n\n\t\t\t\tcreateAccount(user.email, user.password)\n\t\t\t\t.then(function() {\n\t\t\t\t\treturn login(user.email, user.password, user.remember);\n\t\t\t\t})\n\t\t\t\t.catch(function(error) {\n\t\t\t\t\terrorHandler(error);\n\t\t\t\t})\n\t\t\t\t.finally(function() {\n\t\t\t\t\tself.working = false;\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tconsole.log('AuthController [submit]: Login!');\n\n\t\t\t\tlogin(this.user.email, this.user.password, this.user.remember)\n\t\t\t\t.catch(function(error) {\n\t\t\t\t\terrorHandler(error);\n\t\t\t\t})\n\t\t\t\t.finally(function() {\n\t\t\t\t\tself.working = false;\n\t\t\t\t});\n\t\t\t}\n\t\t};\n\n\t\tthis.login3rdParty = function(provider) {\n\t\t\tthis.error = {};\n\t\t\tthis.error.provider = provider.capitalize();\n\n\t\t\tAuthService.login3rdParty(provider)\n\t\t\t.catch(function(error) {\n\t\t\t\terrorHandler(error);\n\t\t\t});\n\t\t};\n\n\t}]);\n\n}());","(function () {\n\t'use strict';\n\n\tangular.module('auth.directives', ['auth.service'])\n\n\t.directive('compareToValidator', function() {\n\t\treturn {\n\t\t\trestrict: 'A',\n\t\t\trequire : 'ngModel',\n\t\t\tlink : function($scope, element, attrs, ngModel) {\n\t\t\t\t$scope.$watch(attrs.compareToValidator, function() {\n\t\t\t\t\tngModel.$validate();\n\t\t\t\t});\n\t\t\t\tngModel.$validators.compareTo = function(value) {\n\t\t\t\t\tvar other = $scope.$eval(attrs.compareToValidator);\n\t\t\t\t\treturn !value || !other || value === other;\n\t\t\t\t};\n\t\t\t}\n\t\t};\n\t})\n\n\t.directive('showAuthed', ['AuthService', '$timeout', function (AuthService, $timeout) {\n\t\tvar isAuthed;\n\t\tAuthService.watch(function(authData) {\n\t\t\tisAuthed = !!authData;\n\t\t});\n\n\t\treturn {\n\t\t\trestrict: 'A',\n\t\t\tlink: function($scope, element) {\n\t\t\t\t// Hide until processed\n\t\t\t\telement.addClass('ng-cloak');\n\n\t\t\t\tfunction update() {\n\t\t\t\t\t// Set view state. Wrapped in timer for reliability\n\t\t\t\t\t$timeout(function() {\n\t\t\t\t\t\telement.toggleClass('ng-cloak', !isAuthed);\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tupdate();\n\t\t\t\tAuthService.watch(update, $scope);\n\t\t\t}\n\t\t};\n\t}])\n\n\t.directive('hideAuthed', ['AuthService', '$timeout', function (AuthService, $timeout) {\n\t\tvar isAuthed;\n\t\tAuthService.watch(function(authData) {\n\t\t\tisAuthed = !!authData;\n\t\t});\n\n\t\treturn {\n\t\t\trestrict: 'A',\n\t\t\tlink: function($scope, element) {\n\t\t\t\t// Hide until processed\n\t\t\t\telement.addClass('ng-cloak');\n\n\t\t\t\tfunction update() {\n\t\t\t\t\t// Set view state. Wrapped in timer for reliability\n\t\t\t\t\t$timeout(function() {\n\t\t\t\t\t\telement.toggleClass('ng-cloak', isAuthed);\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tupdate();\n\t\t\t\tAuthService.watch(update, $scope);\n\t\t\t}\n\t\t};\n\t}]);\n\n}());","(function() {\n\t'use strict';\n\n\tangular.module('auth.service', ['common.config', 'firebase'])\n\t.factory('AuthService', ['FB', '$firebase', '$firebaseAuth', function(FB, $firebase, $firebaseAuth) {\n\t\tvar fbAuth = $firebaseAuth(new Firebase(FB));\n\n\t\tvar listeners = [];\n\n\t\tfunction statusChange(authData) {\n\t\t\tconsole.log('Auth status and data: %o', authData);\n\t\t\tvar oldAuth = ret.auth;\n\t\t\tret.auth = fbAuth.$getAuth();\n\t\t\tangular.forEach(listeners, function(fn) {\n\t\t\t\tfn(ret.auth, oldAuth);\n\t\t\t});\n\t\t}\n\n\t\tvar ret = {\n\t\t\tauth: null,\n\n\t\t\tuid: function() {\n\t\t\t\tif (ret.auth && ret.auth.uid) {\n\t\t\t\t\treturn ret.auth.uid;\n\t\t\t\t}\n\n\t\t\t\treturn null;\n\t\t\t},\n\n\t\t\tgetAuth: function() {\n\t\t\t\treturn fbAuth.$waitForAuth();\n\t\t\t},\n\n\t\t\tcreate: function(email, password) {\n\t\t\t\tvar credentials = {\n\t\t\t\t\temail: email,\n\t\t\t\t\tpassword: password\n\t\t\t\t};\n\n\t\t\t\treturn fbAuth.$createUser(credentials);\n\t\t\t},\n\n\t\t\tlogin: function(email, password, remember) {\n\t\t\t\tvar credentials = {\n\t\t\t\t\temail: email,\n\t\t\t\t\tpassword: password\n\t\t\t\t};\n\n\t\t\t\tvar options = {\n\t\t\t\t\tremember: angular.isDefined(remember) ? remember : 'default'\n\t\t\t\t};\n\n\t\t\t\treturn fbAuth.$authWithPassword(credentials, options);\n\t\t\t},\n\n\t\t\tlogin3rdParty: function(provider) {\n\t\t\t\treturn fbAuth.$authWithOAuthPopup(provider)\n\t\t\t\t.catch(function(error) {\n\t\t\t\t\tif (error && error.code === 'TRANSPORT_UNAVAILABLE') {\n\t\t\t\t\t\t//TODO: Log\n\t\t\t\t\t\treturn fbAuth.$authWithOAuthRedirect(provider);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t},\n\n\t\t\tlogout: function() {\n\t\t\t\tconsole.log('Unauthing');\n\t\t\t\tfbAuth.$unauth();\n\t\t\t},\n\n\t\t\tchangePassword: function(email, oldPassword, newPassword) {\n\t\t\t\treturn fbAuth.$changePassword({\n\t\t\t\t\temail: email,\n\t\t\t\t\toldPassword: oldPassword,\n\t\t\t\t\tnewPassword: newPassword\n\t\t\t\t});\n\t\t\t},\n\n\t\t\tresetPassword: function(email) {\n\t\t\t\treturn fbAuth.$resetPassword({\n\t\t\t\t\temail: email\n\t\t\t\t});\n\t\t\t},\n\n\t\t\twatch: function(cb, $scope) {\n\t\t\t\tret.getAuth().then(function(authData) {\n\t\t\t\t\tcb(authData);\n\t\t\t\t});\n\n\t\t\t\tlisteners.push(cb);\n\n\t\t\t\tvar unbind = function() {\n\t\t\t\t\tvar i = listeners.indexOf(cb);\n\t\t\t\t\tif ( i > -1 ) {\n\t\t\t\t\t\tlisteners.splice(i, 1);\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t\t\tif ($scope) {\n\t\t\t\t\t$scope.$on('$destroy', unbind);\n\t\t\t\t}\n\n\t\t\t\treturn unbind;\n\t\t\t}\n\t\t};\n\n\t\tfbAuth.$onAuth(statusChange);\n\t\tstatusChange();\n\n\t\treturn ret;\n\t}])\n\t.factory('requireAuth', ['$q', 'AuthService', function($q, AuthService) {\n\t\t// Wrapper that rejects the promise if the auth is unset\n\t\treturn function() {\n\t\t\treturn AuthService.getAuth().then(function (auth) {\n\t\t\t\treturn auth ? auth : $q.reject({ authRequired: true });\n\t\t\t});\n\t\t};\n\t}]);\n\n}());","(function () {\n\t'use strict';\n\n\tangular.module('auth', ['ngMessages', 'auth.service', 'auth.controller', 'auth.directives'])\n\n\t.constant('welcomeNoAuthState', 'welcome')\n\t.constant('welcomeAuthState', 'home.home')\n\n\t.config(['$urlRouterProvider', '$stateProvider', 'welcomeNoAuthState', 'welcomeAuthState', function($urlRouterProvider, $stateProvider, welcomeNoAuthState, welcomeAuthState) {\n\t\t$urlRouterProvider.otherwise('/redirect');\n\n\t\t$stateProvider\n\t\t.state('auth', {\n\t\t\tabstract: true,\n\t\t\ttemplate: '<div ui-view></div>',\n\t\t\tresolve: {\n\t\t\t\t'auth': ['AuthService', function(AuthService) {\n\t\t\t\t\treturn AuthService.getAuth();\n\t\t\t\t}]\n\t\t\t}\n\t\t})\n\t\t.state('auth.login', {\n\t\t\turl: '/login',\n\t\t\ttemplateUrl: 'app/auth/auth.tpl.html',\n\t\t\tcontroller: 'AuthController',\n\t\t\tcontrollerAs: 'authCtrl',\n\t\t\tresolve: {\n\t\t\t\t'signup': function() {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\t\t.state('auth.logout', {\n\t\t\tonEnter: ['AuthService', function(AuthService) {\n\t\t\t\tAuthService.logout();\n\t\t\t}],\n\t\t\tcontroller: ['$state', function($state) {\n\t\t\t\t$state.go(welcomeNoAuthState, {reload: true});\n\t\t\t}]\n\t\t})\n\t\t.state('auth.redirect', {\n\t\t\turl: '/redirect',\n\t\t\ttemplateUrl: 'app/auth/auth-pre.tpl.html',\n\t\t\tcontroller: ['$state', function($state) {\n\t\t\t\t$state.go('auth.authenticating');\n\t\t\t}]\n\t\t})\n\t\t.state('auth.authenticating', {\n\t\t\tcontroller: ['auth', '$state', function(auth, $state) {\n\t\t\t\tif (auth === null) {\n\t\t\t\t\tconsole.log('Not authed, redirecting to front page');\n\t\t\t\t\t$state.go(welcomeNoAuthState);\n\t\t\t\t} else {\n\t\t\t\t\tconsole.log('Authed, redirecting');\n\t\t\t\t\t$state.go(welcomeAuthState);\n\t\t\t\t}\n\t\t\t}]\n\t\t});\n\t}])\n\n\t.run(['$rootScope', '$state', 'welcomeAuthState', 'AuthService', function($rootScope, $state, welcomeAuthState, AuthService) {\n\t\tAuthService.watch(function(newAuth, oldAuth) {\n\t\t\t// Just logged in\n\t\t\tif (newAuth && (angular.isUndefined(oldAuth) || oldAuth === null)) {\n\t\t\t\t$state.go(welcomeAuthState);\n\t\t\t}\n\n\t\t\t// Find out if 'auth' is in the resolve list somewhere between the current state and the root.\n\t\t\tfunction routeRequiresAuth(startState) {\n\t\t\t\tvar state = startState;\n\t\t\t\twhile (true) {\n\t\t\t\t\tif (state.resolve && 'requireAuth' in state.resolve) {\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar stateName = state.name;\n\t\t\t\t\tvar lastDot = stateName.lastIndexOf('.');\n\t\t\t\t\tif (lastDot !== -1) {\n\t\t\t\t\t\tvar parentStateName = stateName.substring(0, lastDot);\n\t\t\t\t\t\tstate = $state.get(parentStateName);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\t// Should auth status change while viewing a state requiring auth, the user is redirected to login\n\t\t\tif (!newAuth && routeRequiresAuth($state.current)) {\n\t\t\t\tconsole.warn('Auth is required for the state you are viewing: \"' + $state.current.name + '\". Redirecting you to login.');\n\t\t\t\t$state.go('auth.login');\n\t\t\t}\n\t\t}, $rootScope);\n\n\t\t$rootScope.$on('$stateChangeStart', function(event, toState, toParams, fromState) {\n\t\t\tconsole.log(fromState.name + ' -> ' + toState.name);\n\t\t});\n\n\t\t$rootScope.$on('$stateChangeError', function(event, toState, toParams, fromState, fromParams, error) {\n\t\t\tif(angular.isObject(error) && error.authRequired) {\n\t\t\t\tconsole.warn('Auth required for transitioning to state: \"' +  toState.name + '\". Redirecting you to login.');\n\t\t\t\t$state.go('auth.login');\n\t\t\t}\n\t\t});\n\t}]);\n\n}());","(function () {\n  'use strict';\n\n  angular.module('home', ['auth.service', 'common', 'user', 'ui.bootstrap', 'ngTagsInput'])\n\n  .config(['$urlRouterProvider', '$stateProvider', function($urlRouterProvider, $stateProvider) {\n    $stateProvider\n    .state('home', {\n      abstract: true,\n      url: '/home',\n      template: '<div id=\"home-content\" ui-view></div>',\n      contoller: function($state) {\n        $state.go('home.home');\n      },\n      resolve: {\n        requireAuth: ['requireAuth', function(requireAuth) {\n          return requireAuth();\n        }],\n        snippets: ['UserService', function(UserService) {\n          return UserService.getSnippets();\n        }]\n      }\n    })\n    .state('home.home', {\n      url: '',\n      templateUrl: 'app/home/home.tpl.html',\n      controller: 'HomeController',\n      controllerAs: 'homeCtrl'\n    });\n  }])\n\n  .controller('HomeController', ['snippets', '$modal', '$filter', '$timeout', function(snippets, $modal, $filter, $timeout) {\n    this.snippets = snippets;\n\n    this.openSnippet = function(id) {\n      $modal.open({\n        templateUrl: 'app/home/snippet.modal.tpl.html',\n        controller: 'SnippetController',\n        controllerAs: 'snippetCtrl',\n        resolve: {\n          snippets: function () {\n            return snippets;\n          },\n          snippetId: function() {\n            return id;\n          }\n        }\n      });\n    };\n\n    this.toggleSnippet = function(snippet) {\n      snippet.enabled = !!snippet.enabled;\n      snippets.$save(snippet)\n      .catch(function(error) {\n        console.log('HomeController [toggleSnippet] could not save snippet: ' + error);\n      });\n    };\n\n    this.copyAsMarkdown = function(snippet) {\n      return $filter('tagFill')(snippet, this.values);\n    };\n\n    this.copyAsHTML = function(snippet) {\n      return $filter('ngMarkdown')(this.copyAsMarkdown(snippet));\n    };\n\n    this.copyNotice = false;\n    var self = this;\n\n    this.copyEnabledAsHTML = function() {\n      var text = '';\n      angular.forEach(snippets, function(snippet) {\n        if (snippet.enabled) {\n          text += this.copyAsHTML(snippet);\n        }\n      }, this);\n\n      $timeout(function() {\n        self.copyNotice = true;\n      }, 0);\n\n      $timeout(function() {\n        self.copyNotice = false;\n      }, 1000);\n\n      return text;\n    };\n  }])\n\n  .controller('SnippetController', ['snippets', 'snippetId', '$scope', '$modalInstance', function(snippets, snippetId, $scope, $modalInstance) {\n    this.edit = angular.isDefined(snippetId);\n\n    this.org = {\n      variables : [],\n      enabled: true\n    };\n\n    if (this.edit) {\n      this.org = snippets.$getRecord(snippetId);\n      if (this.org === null) {\n        console.warn('SnippetController [modal] Snippet not available. ID was ' + snippetId);\n        $modalInstance.close();\n      }\n    }\n\n    this.snippet = angular.copy(this.org);\n    this.snippet.variables = angular.copy(this.org.variables);\n    this.tagsChanged = false;\n\n    this.tagMod = function() {\n      this.tagsChanged = !angular.equals(this.org.variables, this.snippet.variables);\n    };\n\n    this.addSnippet = function () {\n      snippets.$add(this.snippet);\n      $modalInstance.close();\n    };\n\n    this.saveSnippet = function () {\n      angular.extend(this.org, this.snippet);\n      snippets.$save(this.org)\n      .catch(function(error) {\n        console.log('SnippetController [saveSnippet] could not save item: ' + error);\n      })\n      .finally(function() {\n        $modalInstance.close();\n      });\n    };\n\n    this.close = function() {\n      $modalInstance.close();\n    };\n\n    this.cancel = function() {\n      $modalInstance.dismiss();\n    };\n\n    this.delete = function() {\n      snippets.$remove(this.org)\n      .catch(function(error) {\n        console.warn('SnippetController [delete] Could not delete snippet. Snippet was ' + this.org + ' and error was ' + error.code);\n      })\n      .then(function() {\n        $modalInstance.close();\n      });\n    };\n  }]);\n\n}());","(function () {\n\t/* jshint -W121 */\n\n\t'use strict';\n\n\tangular.module('common', ['common.config', 'common.firebase.factory', 'common.filters']);\n\tString.prototype.capitalize = function() {\n    return this.charAt(0).toUpperCase() + this.slice(1);\n\t};\n\n}());","(function () {\n\t'use strict';\n\n\tangular.module('common.config', [])\n\t.constant('FB', 'https://snippetmanager.firebaseio.com/');\n\n}());","(function () {\n  'use strict';\n\n\n  angular.module('common.filters', [])\n\n  .filter('tagFill', function () {\n    return function(snippet, values) {\n      var text = snippet.content;\n      var newText = text;\n      for (var variableIndex in snippet.variables) {\n        if (snippet.variables.hasOwnProperty(variableIndex)) {\n\n          var variable = snippet.variables[variableIndex];\n          if (values.hasOwnProperty(variable.tag) && values[variable.tag].length > 0) {\n            newText = newText.replace(new RegExp(variable.tag, 'g'), values[variable.tag]);\n          } else if (variable.placeholder && variable.placeholder.length > 0) {\n            newText = newText.replace(new RegExp(variable.tag, 'g'), '(' + variable.placeholder + ')');\n          }\n        }\n      }\n\n      return newText;\n    };\n  })\n\n  .filter('html', ['$sce', function($sce) {\n    return function(val) {\n      return $sce.trustAsHtml(val);\n    };\n  }]);\n\n}());","(function() {\n\t'use strict';\n\n\tangular.module('common.firebase.factory', ['firebase'])\n\n\t.factory('FirebaseFactory', ['FB', '$q', '$firebase', function(FB, $q, $firebase) {\n\t\tvar baseRef = new Firebase(FB);\n\n\t\tvar ret = {\n\t\t\tdelete: function(path) {\n\t\t\t\tvar deferred = $q.defer();\n\n\t\t\t\tvar ref = baseRef.child(path);\n\t\t\t\tref.set({}, function(error) {\n\t\t\t\t\tif (error) {\n\t\t\t\t\t\tconsole.warn('FirebaseFactory [delete] of ' + path + ' failed: %o', error);\n\t\t\t\t\t\tdeferred.reject('FirebaseFactory [delete] of ' + path + ' failed with error code ' + error.code);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdeferred.resolve();\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\treturn deferred.promise;\n\t\t\t},\n\n\t\t\tgetOnce: function(path) {\n\t\t\t\tvar deferred = $q.defer();\n\n\t\t\t\tvar ref = baseRef.child(path);\n\t\t\t\tref.once('value', function(data) {\n\t\t\t\t\tdeferred.resolve(data.val());\n\t\t\t\t}, function(error) {\n\t\t\t\t\tconsole.warn('FirebaseFactory [getOnce] of ' + path + ' failed: %o', error);\n\t\t\t\t\tdeferred.reject('FirebaseFactory [getOnce] of ' + path + ' failed with error code ' + error.code);\n\t\t\t\t});\n\n\t\t\t\treturn deferred.promise;\n\t\t\t},\n\n\t\t\tgetAsArray: function(path) {\n\t\t\t\tvar ref = baseRef.child(path);\n\n\t\t\t\treturn $firebase(ref).$asArray();\n\t\t\t},\n\n\t\t\tgetAsObject: function(path) {\n\t\t\t\tvar ref = baseRef.child(path);\n\n\t\t\t\treturn $firebase(ref).$asObject();\n\t\t\t},\n\n\t\t\tset: function(path, object) {\n\t\t\t\tvar deferred = $q.defer();\n\n\t\t\t\tvar ref = baseRef.child(path);\n\t\t\t\tref.set(object, function(error) {\n\t\t\t\t\tif (error) {\n\t\t\t\t\t\tconsole.warn('FirebaseFactory [set] of ' + path + ' failed: %o', error);\n\t\t\t\t\t\tdeferred.reject('FirebaseFactory [set] of ' + path + ' failed with error code ' + error.code);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdeferred.resolve();\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\treturn deferred.promise;\n\t\t\t},\n\n\t\t\tupdate: function(path, object) {\n\t\t\t\tvar deferred = $q.defer();\n\n\t\t\t\tvar ref = baseRef.child(path);\n\t\t\t\tref.update(object, function(error) {\n\t\t\t\t\tif (error) {\n\t\t\t\t\t\tconsole.warn('FirebaseFactory [update] of ' + path + ' failed: %o', error);\n\t\t\t\t\t\tdeferred.reject('FirebaseFactory [update] of ' + path + ' failed with error code ' + error.code);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdeferred.resolve();\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\treturn deferred.promise;\n\t\t\t}\n\t\t};\n\n\t\treturn ret;\n\t}])\n\n\t.factory('ObjectCache', ['$firebase', function ($firebase) {\n\t\treturn function (ref) {\n\t\t\tvar cached = {};\n\n\t\t\t// Fills cache with\n\t\t\tcached.$init = function() {\n\t\t\t\tref.on('child_added', function(snapshot) {\n\t\t\t\t\tcached.$load(snapshot.key());\n\t\t\t\t});\n\t\t\t};\n\n\t\t\t// Load object into cache\n\t\t\tcached.$load = function (id) {\n\t\t\t\tif( !cached.hasOwnProperty(id) ) {\n\t\t\t\t\tcached[id] = $firebase(ref.child(id)).$asObject();\n\t\t\t\t}\n\n\t\t\t\treturn cached[id];\n\t\t\t};\n\n\t\t\t// Frees memory and stops listening on objects.\n\t\t\t// Use this when you switch views in your SPA and no longer need this list.\n\t\t\tcached.$dispose = function () {\n\t\t\t\tangular.forEach(cached, function (object) {\n\t\t\t\t\tobject.$destroy();\n\t\t\t\t});\n\t\t\t};\n\n\t\t\t// Removes an object, both form cache and on Firebase\n\t\t\tcached.$remove = function(id) {\n\t\t\t\tdelete cached[id];\n\t\t\t\tref.child(id).remove();\n\t\t\t};\n\n\t\t\treturn cached;\n\t\t};\n\t}]);\n\n}());","(function() {\n  'use strict';\n\n  angular.module('menu.controller', ['common', 'auth'])\n  .controller('MenuController', ['AuthService', function (AuthService) {\n    this.name = '';\n\n    var self = this;\n    AuthService.watch(function(authData) {\n      if (authData) {\n        if (authData.provider === 'password') {\n          self.name = authData.password.email;\n        } else if (authData.provider === 'facebook' || authData.provider === 'twitter' || authData.provider === 'google') {\n          self.name = authData[authData.provider].displayName;\n        } else {\n          self.name = '';\n        }\n      } else {\n        self.name = '';\n      }\n    });\n\n  }]);\n\n}());","(function () {\n  'use strict';\n\n  angular.module('menu.directive', ['menu.controller'])\n  .directive('siteMenu', function() {\n    return {\n      restrict: 'E',\n      scope: true,\n      templateUrl: 'app/menu/menu.tpl.html',\n      controller: 'MenuController',\n      controllerAs: 'menuCtrl'\n    };\n  });\n\n}());","(function () {\n  'use strict';\n\n  angular.module('menu', ['menu.directive', 'menu.controller']);\n\n}());","(function () {\n  'use strict';\n\n  angular.module('welcome', ['menu'])\n\n  .config(['$stateProvider', function($stateProvider) {\n    $stateProvider\n    .state('welcome', {\n      url: '/welcome',\n      templateUrl: 'app/welcome/welcome.tpl.html',\n      controller: 'WelcomeController',\n      controllerAs: 'welcomeCtrl'\n    });\n  }])\n\n  .controller('WelcomeController', ['$filter', function($filter) {\n\n    this.snippet = {\n      content: 'Hello <b>NAME</b>! I can see that you are working for <b>COMPANY</b> and I thought you might be interested in our service. It makes it possible to use variables in snippets of text. It even supports Markdown and copy to clipboard as HTML.<br /><br /><br/> <b>NAME</b> when did I last tell you that you were awesome?',\n      variables: [{\n        tag: 'NAME',\n        placeholder:'Your name'\n      },{\n        tag: 'COMPANY',\n        placeholder:'Where you work'\n      }]\n    };\n\n    this.copyAsMarkdown = function(snippet) {\n      return $filter('tagFill')(snippet, this.values);\n    };\n\n    this.copyAsHTML = function(snippet) {\n      return $filter('ngMarkdown')(this.copyAsMarkdown(snippet));\n    };\n  }]);\n\n}());","(function() {\n  'use strict';\n\n  angular.module('user.service', ['common', 'auth'])\n  .factory('UserService', ['$q', 'FB', 'FirebaseFactory', 'AuthService', function($q, FB, FirebaseFactory, AuthService) {\n    var version = 2;\n\n    var base = '/users/';\n\n    var uid = null;\n\n    var load = function() {\n      var deferred = $q.defer();\n\n      AuthService.getAuth()\n      .then(function(data) {\n        if (uid === data.uid) {\n          deferred.resolve();\n        } else {\n          uid = data.uid;\n\n          return FirebaseFactory.getOnce(base + uid + '/version')\n          .then(function(userVersion) {\n            console.log('UserService got version: ' + userVersion);\n\n            if (userVersion === null) {\n              // No User data for this uid. Let's create it.\n              return FirebaseFactory.set(base + uid, {\n                version: version\n              })\n              .then(function() {\n                deferred.resolve();\n              });\n            } else if (version !== userVersion) {\n              if (angular.isNumber(userVersion)) {\n                console.log('UserService perform upgrade from v ' + userVersion + ' to v ' + version);\n                if (userVersion === 1) {\n                  var snippetsPath = '/users/' + uid + '/snippets';\n\n                  return FirebaseFactory.getOnce(snippetsPath)\n                  .then(function(data) {\n                    return FirebaseFactory.delete(snippetsPath)\n                    .then(function() {\n                      if (data !== null) {\n                        var snippets2 = FirebaseFactory.getAsArray(snippetsPath);\n                        for (var i = 0; i < data.length; i++) {\n                          snippets2.$add(data[i]);\n                        }\n                      }\n                    });\n                  })\n                  .then(function() {\n                    return FirebaseFactory.update(base + uid, {\n                      version: version\n                    });\n                  })\n                  .then(function() {\n                    console.log('Upgrade completed');\n                  })\n                  .catch(function(error) {\n                    console.error('Upgrade errored: %o', error);\n                    return $q.reject(new Error('Upgrade errored: ' + error));\n                  });\n                }\n              } else {\n                console.error('UserService: Version is not a number: ' + userVersion);\n              }\n            }\n            //TODO: watch for version to change ?\n          });\n        }\n      })\n      .then(function() {\n        // User ready\n        deferred.resolve();\n      })\n      .catch(function(error) {\n        deferred.reject('UserService [load] error ' + error.code);\n      });\n\n      return deferred.promise;\n    };\n\n    var service = {\n      getData: function() {\n        return load()\n        .then(function() {\n          return FirebaseFactory.getAsObject(base + uid + '/data');\n        });\n      },\n\n      getSnippets: function() {\n        return load()\n        .then(function() {\n          return FirebaseFactory.getAsArray(base + uid + '/snippets');\n        });\n      }\n    };\n\n    return service;\n  }]);\n\n}());","(function () {\n  'use strict';\n\n  angular.module('user', ['user.service']);\n\n}());"],"sourceRoot":"/source/"}